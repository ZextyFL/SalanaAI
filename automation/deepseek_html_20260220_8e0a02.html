<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supplier Payments - GURU AI</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://kit.fontawesome.com/your-kit-code.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .payments-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: var(--blur-xl);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: var(--border-glow);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient-primary);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 24px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 13px;
            color: var(--gray);
        }
        
        .stat-trend {
            font-size: 12px;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 20px;
            display: inline-block;
        }
        
        .trend-up {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }
        
        .trend-down {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }
        
        /* Suppliers Grid */
        .suppliers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .supplier-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: var(--blur-xl);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .supplier-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: var(--border-glow);
        }
        
        .supplier-card.paid::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 80px;
            height: 80px;
            background: var(--success);
            clip-path: polygon(100% 0, 0 0, 100% 100%);
            opacity: 0.2;
        }
        
        .supplier-card.overdue::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 80px;
            height: 80px;
            background: var(--danger);
            clip-path: polygon(100% 0, 0 0, 100% 100%);
            opacity: 0.2;
        }
        
        .supplier-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .supplier-avatar {
            width: 60px;
            height: 60px;
            background: var(--gradient-primary);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
            color: white;
        }
        
        .supplier-info h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .supplier-info p {
            font-size: 13px;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .supplier-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 5px;
        }
        
        .star-filled {
            color: #fbbf24;
        }
        
        .star-empty {
            color: var(--gray);
            opacity: 0.3;
        }
        
        /* Payment Details */
        .payment-details {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .payment-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .payment-row:last-child {
            border-bottom: none;
        }
        
        .payment-label {
            color: var(--gray);
            font-size: 14px;
        }
        
        .payment-value {
            font-weight: 600;
            font-size: 16px;
        }
        
        .payment-value.due {
            color: var(--warning);
        }
        
        .payment-value.overdue {
            color: var(--danger);
        }
        
        .payment-value.paid {
            color: var(--success);
        }
        
        /* Products List */
        .products-list {
            margin: 15px 0;
        }
        
        .product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 13px;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.05);
        }
        
        .product-name {
            color: var(--gray);
        }
        
        .product-quantity {
            font-weight: 600;
        }
        
        /* Progress Bar */
        .payment-progress {
            margin: 15px 0;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 10px;
            transition: width 0.3s;
        }
        
        /* Supplier Actions */
        .supplier-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .action-btn {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .action-btn:hover {
            background: var(--gradient-primary);
            border-color: transparent;
        }
        
        .action-btn.pay-btn {
            background: var(--gradient-primary);
        }
        
        .action-btn.pay-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--border-glow);
        }
        
        /* Payment History */
        .history-section {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: var(--blur-xl);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            margin-top: 30px;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .history-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .history-table th {
            text-align: left;
            padding: 15px;
            color: var(--gray);
            font-weight: 500;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .history-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .payment-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-paid {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }
        
        .status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }
        
        .status-overdue {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            width: 500px;
            max-width: 90%;
            background: var(--dark);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
        }
        
        .modal-title {
            font-size: 24px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--gray);
            font-size: 13px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .payment-methods {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        
        .payment-method {
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .payment-method:hover,
        .payment-method.selected {
            background: var(--gradient-primary);
            border-color: transparent;
        }
        
        .payment-method i {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        /* Auto-pay Toggle */
        .auto-pay-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.2);
            transition: .3s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background: var(--gradient-primary);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* Quick Action Buttons */
        .quick-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .quick-action-card {
            flex: 1;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .quick-action-card:hover {
            transform: translateY(-3px);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(236, 72, 153, 0.2) 100%);
        }
        
        .quick-action-icon {
            font-size: 30px;
            margin-bottom: 10px;
        }
        
        .quick-action-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .quick-action-desc {
            font-size: 12px;
            color: var(--gray);
        }
        
        /* Invoice Badge */
        .invoice-badge {
            display: inline-block;
            padding: 2px 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 10px;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <div style="padding: 20px;">
        <div class="payments-header">
            <h2 style="font-size: 24px;">üí∞ Supplier Payments</h2>
            <div style="display: flex; gap: 10px;">
                <button class="btn" onclick="syncPayments()">
                    <i class="fas fa-sync"></i> Sync
                </button>
                <button class="btn" onclick="showAddSupplierModal()">
                    <i class="fas fa-plus"></i> Add Supplier
                </button>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="stat-value" id="totalPayable">$45,678</div>
                <div class="stat-label">Total Payable</div>
                <div class="stat-trend trend-up">‚Üë 12% from last month</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-value" id="dueSoon">$12,345</div>
                <div class="stat-label">Due in 7 days</div>
                <div class="stat-trend trend-down">8 invoices</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-value" id="overdue">$5,678</div>
                <div class="stat-label">Overdue</div>
                <div class="stat-trend trend-down">3 invoices</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-value" id="paidThisMonth">$23,456</div>
                <div class="stat-label">Paid this month</div>
                <div class="stat-trend trend-up">‚Üë 8%</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <div class="quick-action-card" onclick="payAllDue()">
                <div class="quick-action-icon">‚ö°</div>
                <div class="quick-action-title">Pay All Due</div>
                <div class="quick-action-desc">Pay all pending invoices</div>
            </div>
            <div class="quick-action-card" onclick="scheduleBulk()">
                <div class="quick-action-icon">üìÖ</div>
                <div class="quick-action-title">Schedule Bulk</div>
                <div class="quick-action-desc">Schedule payments</div>
            </div>
            <div class="quick-action-card" onclick="exportReport()">
                <div class="quick-action-icon">üìä</div>
                <div class="quick-action-title">Export Report</div>
                <div class="quick-action-desc">Download payment report</div>
            </div>
            <div class="quick-action-card" onclick="reconcileAll()">
                <div class="quick-action-icon">üîÑ</div>
                <div class="quick-action-title">Reconcile</div>
                <div class="quick-action-desc">Auto-reconcile payments</div>
            </div>
        </div>

        <!-- Suppliers Grid -->
        <h3 style="margin-bottom: 20px;">Your Suppliers</h3>
        <div class="suppliers-grid" id="suppliersGrid">
            <!-- Will be populated by JS -->
        </div>

        <!-- Payment History -->
        <div class="history-section">
            <div class="history-header">
                <div class="history-title">
                    <i class="fas fa-history"></i>
                    Recent Payment History
                </div>
                <button class="view-all-btn" onclick="viewAllHistory()">
                    View All <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            
            <table class="history-table" id="historyTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Supplier</th>
                        <th>Invoice #</th>
                        <th>Amount</th>
                        <th>Method</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="historyBody">
                    <!-- Will be populated by JS -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <h3 class="modal-title">Process Payment</h3>
            <div id="paymentSupplierInfo"></div>
            
            <div class="payment-methods">
                <div class="payment-method selected" onclick="selectPaymentMethod('wire')">
                    <i class="fas fa-university"></i>
                    <div>Wire Transfer</div>
                </div>
                <div class="payment-method" onclick="selectPaymentMethod('paypal')">
                    <i class="fab fa-paypal"></i>
                    <div>PayPal</div>
                </div>
                <div class="payment-method" onclick="selectPaymentMethod('stripe')">
                    <i class="fab fa-stripe"></i>
                    <div>Stripe</div>
                </div>
                <div class="payment-method" onclick="selectPaymentMethod('credit')">
                    <i class="fas fa-credit-card"></i>
                    <div>Credit Card</div>
                </div>
            </div>
            
            <div class="form-group">
                <label>Amount to Pay</label>
                <input type="number" id="paymentAmount" value="0" min="0">
            </div>
            
            <div class="form-group">
                <label>Payment Date</label>
                <input type="date" id="paymentDate" value="<?php echo date('Y-m-d'); ?>">
            </div>
            
            <div class="form-group">
                <label>Reference/Notes</label>
                <input type="text" id="paymentNotes" placeholder="Invoice # or notes">
            </div>
            
            <div class="auto-pay-toggle">
                <span>Enable Auto-Pay for future invoices</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="autoPay" onchange="toggleAutoPay()">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="btn" style="flex: 1;" onclick="processPayment()">
                    <i class="fas fa-check"></i> Confirm Payment
                </button>
                <button class="btn" style="flex: 1; background: transparent;" onclick="closePaymentModal()">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Add Supplier Modal -->
    <div class="modal" id="addSupplierModal">
        <div class="modal-content">
            <h3 class="modal-title">Add New Supplier</h3>
            
            <div class="form-group">
                <label>Supplier Name</label>
                <input type="text" id="supplierName" placeholder="e.g., Tech Distributors Inc.">
            </div>
            
            <div class="form-group">
                <label>Contact Person</label>
                <input type="text" id="contactPerson" placeholder="John Smith">
            </div>
            
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="supplierEmail" placeholder="contact@supplier.com">
            </div>
            
            <div class="form-group">
                <label>Phone</label>
                <input type="text" id="supplierPhone" placeholder="+1 (555) 123-4567">
            </div>
            
            <div class="form-group">
                <label>Payment Terms (days)</label>
                <select id="paymentTerms">
                    <option value="15">Net 15</option>
                    <option value="30" selected>Net 30</option>
                    <option value="45">Net 45</option>
                    <option value="60">Net 60</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Default Payment Method</label>
                <select id="defaultMethod">
                    <option value="wire">Wire Transfer</option>
                    <option value="paypal">PayPal</option>
                    <option value="stripe">Stripe</option>
                    <option value="credit">Credit Card</option>
                </select>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="btn" style="flex: 1;" onclick="addSupplier()">Add Supplier</button>
                <button class="btn" style="flex: 1; background: transparent;" onclick="closeAddSupplierModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        let suppliers = [
            {
                id: 1,
                name: 'Tech Distributors Inc.',
                contact: 'John Smith',
                email: 'john@techdistributors.com',
                phone: '+1 (555) 123-4567',
                rating: 4.8,
                products: ['Wireless Headphones', 'Smart Watches', 'Chargers'],
                paymentTerms: 30,
                balance: 12500,
                dueDate: '2024-02-15',
                status: 'pending',
                autoPay: false,
                avatar: 'TD',
                paymentHistory: [
                    { date: '2024-01-15', amount: 8900, status: 'paid' },
                    { date: '2023-12-15', amount: 12300, status: 'paid' }
                ]
            },
            {
                id: 2,
                name: 'Global Gadgets Ltd.',
                contact: 'Sarah Chen',
                email: 'sarah@globalgadgets.com',
                phone: '+1 (555) 234-5678',
                rating: 4.5,
                products: ['Phone Cases', 'Screen Protectors', 'Cables'],
                paymentTerms: 15,
                balance: 5600,
                dueDate: '2024-02-10',
                status: 'pending',
                autoPay: true,
                avatar: 'GG',
                paymentHistory: [
                    { date: '2024-01-25', amount: 4300, status: 'paid' },
                    { date: '2024-01-10', amount: 6200, status: 'paid' }
                ]
            },
            {
                id: 3,
                name: 'Premium Suppliers Co.',
                contact: 'Michael Brown',
                email: 'michael@premiumsuppliers.com',
                phone: '+1 (555) 345-6789',
                rating: 4.9,
                products: ['MacBook Accessories', 'iPad Cases', 'Premium Cables'],
                paymentTerms: 45,
                balance: 18700,
                dueDate: '2024-02-28',
                status: 'pending',
                autoPay: false,
                avatar: 'PS',
                paymentHistory: [
                    { date: '2024-01-05', amount: 15600, status: 'paid' }
                ]
            },
            {
                id: 4,
                name: 'Electronics Wholesale',
                contact: 'David Wilson',
                email: 'david@ewholesale.com',
                phone: '+1 (555) 456-7890',
                rating: 4.2,
                products: ['Audio Equipment', 'Speakers', 'Microphones'],
                paymentTerms: 30,
                balance: 3450,
                dueDate: '2024-02-05',
                status: 'overdue',
                autoPay: false,
                avatar: 'EW',
                paymentHistory: [
                    { date: '2023-12-20', amount: 8900, status: 'paid' },
                    { date: '2023-11-20', amount: 6700, status: 'paid' }
                ]
            },
            {
                id: 5,
                name: 'Accessories Plus',
                contact: 'Lisa Anderson',
                email: 'lisa@accessoriesplus.com',
                phone: '+1 (555) 567-8901',
                rating: 4.7,
                products: ['Phone Grips', 'PopSockets', 'Car Mounts'],
                paymentTerms: 30,
                balance: 2300,
                dueDate: '2024-02-20',
                status: 'pending',
                autoPay: true,
                avatar: 'AP',
                paymentHistory: [
                    { date: '2024-01-18', amount: 1800, status: 'paid' }
                ]
            },
            {
                id: 6,
                name: 'Battery World',
                contact: 'Robert Taylor',
                email: 'robert@batteryworld.com',
                phone: '+1 (555) 678-9012',
                rating: 4.4,
                products: ['Power Banks', 'Batteries', 'Charging Stations'],
                paymentTerms: 15,
                balance: 8900,
                dueDate: '2024-02-01',
                status: 'overdue',
                autoPay: false,
                avatar: 'BW',
                paymentHistory: [
                    { date: '2024-01-01', amount: 5600, status: 'paid' }
                ]
            }
        ];

        let paymentHistory = [
            { date: '2024-01-28', supplier: 'Tech Distributors Inc.', invoice: 'INV-2024-0128', amount: 8900, method: 'Wire Transfer', status: 'paid' },
            { date: '2024-01-25', supplier: 'Global Gadgets Ltd.', invoice: 'INV-2024-0125', amount: 4300, method: 'PayPal', status: 'paid' },
            { date: '2024-01-20', supplier: 'Premium Suppliers Co.', invoice: 'INV-2024-0120', amount: 5600, method: 'Stripe', status: 'paid' },
            { date: '2024-01-15', supplier: 'Tech Distributors Inc.', invoice: 'INV-2024-0115', amount: 12300, method: 'Wire Transfer', status: 'paid' },
            { date: '2024-01-10', supplier: 'Global Gadgets Ltd.', invoice: 'INV-2024-0110', amount: 6200, method: 'PayPal', status: 'paid' },
            { date: '2024-01-05', supplier: 'Premium Suppliers Co.', invoice: 'INV-2024-0105', amount: 15600, method: 'Wire Transfer', status: 'paid' }
        ];

        let selectedPaymentMethod = 'wire';
        let currentSupplierId = null;

        // Load suppliers
        function loadSuppliers() {
            const grid = document.getElementById('suppliersGrid');
            
            grid.innerHTML = suppliers.map(s => {
                const today = new Date();
                const dueDate = new Date(s.dueDate);
                const daysUntilDue = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                
                let statusClass = 'pending';
                let statusText = 'Pending';
                
                if (s.status === 'overdue' || daysUntilDue < 0) {
                    statusClass = 'overdue';
                    statusText = 'Overdue';
                } else if (daysUntilDue <= 7) {
                    statusClass = 'pending';
                    statusText = 'Due Soon';
                } else {
                    statusClass = 'pending';
                    statusText = 'Pending';
                }
                
                const progress = ((s.balance / 20000) * 100).toFixed(0);
                
                return `
                    <div class="supplier-card ${s.status === 'overdue' ? 'overdue' : ''}" data-id="${s.id}">
                        <div class="supplier-header">
                            <div class="supplier-avatar">${s.avatar}</div>
                            <div class="supplier-info">
                                <h3>${s.name}</h3>
                                <p><i class="fas fa-user"></i> ${s.contact}</p>
                                <p><i class="fas fa-envelope"></i> ${s.email}</p>
                                <div class="supplier-rating">
                                    ${generateStars(s.rating)}
                                    <span style="font-size: 12px; color: var(--gray); margin-left: 5px;">${s.rating}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="payment-details">
                            <div class="payment-row">
                                <span class="payment-label">Balance Due:</span>
                                <span class="payment-value ${statusClass}">$${s.balance.toLocaleString()}</span>
                            </div>
                            <div class="payment-row">
                                <span class="payment-label">Due Date:</span>
                                <span class="payment-value ${statusClass}">${new Date(s.dueDate).toLocaleDateString()} (${daysUntilDue < 0 ? Math.abs(daysUntilDue) + ' days overdue' : daysUntilDue + ' days'})</span>
                            </div>
                            <div class="payment-row">
                                <span class="payment-label">Payment Terms:</span>
                                <span class="payment-value">Net ${s.paymentTerms}</span>
                            </div>
                        </div>
                        
                        <div class="products-list">
                            <div style="font-size: 12px; color: var(--gray); margin-bottom: 8px;">Products Supplied:</div>
                            ${s.products.map(p => `
                                <div class="product-item">
                                    <span class="product-name">${p}</span>
                                    <span class="product-quantity">In Stock</span>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="payment-progress">
                            <div class="progress-header">
                                <span>Payment Progress</span>
                                <span>${progress}% of credit limit</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        
                        <div class="supplier-actions">
                            <button class="action-btn pay-btn" onclick="openPaymentModal(${s.id})">
                                <i class="fas fa-dollar-sign"></i> Pay Now
                            </button>
                            <button class="action-btn" onclick="viewSupplierDetails(${s.id})">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="action-btn" onclick="contactSupplier(${s.id})">
                                <i class="fas fa-envelope"></i> Contact
                            </button>
                        </div>
                        
                        ${s.autoPay ? '<span style="position: absolute; bottom: 10px; left: 10px; font-size: 10px; color: var(--success);"><i class="fas fa-robot"></i> Auto-Pay Enabled</span>' : ''}
                    </div>
                `;
            }).join('');
            
            updateStats();
            loadHistory();
        }

        // Generate star ratings
        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= Math.floor(rating)) {
                    stars += '<i class="fas fa-star star-filled"></i>';
                } else if (i - rating < 1 && i - rating > 0) {
                    stars += '<i class="fas fa-star-half-alt star-filled"></i>';
                } else {
                    stars += '<i class="far fa-star star-empty"></i>';
                }
            }
            return stars;
        }

        // Update statistics
        function updateStats() {
            const totalPayable = suppliers.reduce((sum, s) => sum + s.balance, 0);
            const dueSoon = suppliers.filter(s => {
                const dueDate = new Date(s.dueDate);
                const today = new Date();
                const daysUntilDue = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                return daysUntilDue <= 7 && daysUntilDue >= 0;
            }).reduce((sum, s) => sum + s.balance, 0);
            
            const overdue = suppliers.filter(s => s.status === 'overdue').reduce((sum, s) => sum + s.balance, 0);
            const paidThisMonth = paymentHistory.reduce((sum, p) => sum + p.amount, 0);
            
            document.getElementById('totalPayable').textContent = '$' + totalPayable.toLocaleString();
            document.getElementById('dueSoon').textContent = '$' + dueSoon.toLocaleString();
            document.getElementById('overdue').textContent = '$' + overdue.toLocaleString();
            document.getElementById('paidThisMonth').textContent = '$' + paidThisMonth.toLocaleString();
        }

        // Load payment history
        function loadHistory() {
            const tbody = document.getElementById('historyBody');
            
            tbody.innerHTML = paymentHistory.slice(0, 5).map(h => `
                <tr>
                    <td>${new Date(h.date).toLocaleDateString()}</td>
                    <td>${h.supplier}</td>
                    <td>${h.invoice}</td>
                    <td>$${h.amount.toLocaleString()}</td>
                    <td>${h.method}</td>
                    <td><span class="payment-status status-${h.status}">${h.status.toUpperCase()}</span></td>
                    <td>
                        <button class="action-btn" style="padding: 5px 10px;" onclick="viewInvoice('${h.invoice}')">
                            <i class="fas fa-receipt"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Open payment modal
        function openPaymentModal(supplierId) {
            currentSupplierId = supplierId;
            const supplier = suppliers.find(s => s.id === supplierId);
            
            if (supplier) {
                document.getElementById('paymentSupplierInfo').innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                        <div class="supplier-avatar" style="width: 50px; height: 50px;">${supplier.avatar}</div>
                        <div>
                            <h4 style="font-size: 18px;">${supplier.name}</h4>
                            <p style="color: var(--gray);">Balance: $${supplier.balance.toLocaleString()}</p>
                        </div>
                    </div>
                `;
                document.getElementById('paymentAmount').value = supplier.balance;
                document.getElementById('paymentAmount').max = supplier.balance;
                document.getElementById('paymentModal').classList.add('active');
            }
        }

        // Close payment modal
        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
            currentSupplierId = null;
        }

        // Select payment method
        function selectPaymentMethod(method) {
            selectedPaymentMethod = method;
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
        }

        // Process payment
        function processPayment() {
            const amount = parseFloat(document.getElementById('paymentAmount').value);
            const date = document.getElementById('paymentDate').value;
            const notes = document.getElementById('paymentNotes').value;
            
            if (!amount || amount <= 0) {
                window.parent.showToast('‚ö†Ô∏è Please enter a valid amount');
                return;
            }
            
            const supplier = suppliers.find(s => s.id === currentSupplierId);
            if (supplier && amount <= supplier.balance) {
                // Update supplier balance
                supplier.balance -= amount;
                
                // Add to payment history
                paymentHistory.unshift({
                    date: date,
                    supplier: supplier.name,
                    invoice: 'INV-' + new Date().getTime().toString().slice(-8),
                    amount: amount,
                    method: document.querySelector('.payment-method.selected div:nth-child(2)').textContent,
                    status: 'paid'
                });
                
                window.parent.showToast(`‚úÖ Payment of $${amount.toLocaleString()} to ${supplier.name} processed successfully!`);
                
                // Check if auto-pay should be enabled
                if (document.getElementById('autoPay').checked) {
                    supplier.autoPay = true;
                    window.parent.showToast('ü§ñ Auto-pay enabled for this supplier');
                }
                
                // Auto-reconcile (simulate)
                setTimeout(() => {
                    window.parent.showToast('üîÑ Payment reconciled automatically');
                }, 1000);
                
                closePaymentModal();
                loadSuppliers();
                updateStats();
                loadHistory();
            }
        }

        // Pay all due
        function payAllDue() {
            const dueSuppliers = suppliers.filter(s => {
                const dueDate = new Date(s.dueDate);
                const today = new Date();
                const daysUntilDue = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                return daysUntilDue <= 7 || s.status === 'overdue';
            });
            
            if (dueSuppliers.length === 0) {
                window.parent.showToast('‚úÖ No pending payments due');
                return;
            }
            
            let totalAmount = dueSuppliers.reduce((sum, s) => sum + s.balance, 0);
            
            if (confirm(`Process bulk payment of $${totalAmount.toLocaleString()} for ${dueSuppliers.length} suppliers?`)) {
                dueSuppliers.forEach(supplier => {
                    // Process payment
                    paymentHistory.unshift({
                        date: new Date().toISOString().split('T')[0],
                        supplier: supplier.name,
                        invoice: 'INV-BULK-' + new Date().getTime().toString().slice(-6),
                        amount: supplier.balance,
                        method: 'Bulk Transfer',
                        status: 'paid'
                    });
                    supplier.balance = 0;
                    supplier.status = 'paid';
                });
                
                window.parent.showToast(`‚úÖ Bulk payment of $${totalAmount.toLocaleString()} processed successfully!`);
                loadSuppliers();
                updateStats();
                loadHistory();
            }
        }

        // Schedule bulk payments
        function scheduleBulk() {
            window.parent.showToast('üìÖ Opening payment scheduler...');
        }

        // Export report
        function exportReport() {
            window.parent.showToast('üìä Generating payment report...');
            setTimeout(() => {
                window.parent.showToast('‚úÖ Report downloaded!');
            }, 2000);
        }

        // Reconcile all
        function reconcileAll() {
            window.parent.showToast('üîÑ Auto-reconciling payments...');
            setTimeout(() => {
                window.parent.showToast('‚úÖ Reconciliation complete!');
            }, 2000);
        }

        // View supplier details
        function viewSupplierDetails(id) {
            const supplier = suppliers.find(s => s.id === id);
            window.parent.showToast(`üìã Viewing details for ${supplier.name}`);
        }

        // Contact supplier
        function contactSupplier(id) {
            const supplier = suppliers.find(s => s.id === id);
            window.parent.showToast(`üìß Opening contact form for ${supplier.name}`);
        }

        // View invoice
        function viewInvoice(invoice) {
            window.parent.showToast(`üìÑ Viewing invoice ${invoice}`);
        }

        // View all history
        function viewAllHistory() {
            window.parent.showToast('üìú Loading complete payment history...');
        }

        // Sync payments
        function syncPayments() {
            window.parent.showToast('üîÑ Syncing with payment providers...');
            setTimeout(() => {
                window.parent.showToast('‚úÖ Sync complete!');
            }, 2000);
        }

        // Show add supplier modal
        function showAddSupplierModal() {
            document.getElementById('addSupplierModal').classList.add('active');
        }

        // Close add supplier modal
        function closeAddSupplierModal() {
            document.getElementById('addSupplierModal').classList.remove('active');
        }

        // Add supplier
        function addSupplier() {
            const name = document.getElementById('supplierName').value;
            const contact = document.getElementById('contactPerson').value;
            const email = document.getElementById('supplierEmail').value;
            const phone = document.getElementById('supplierPhone').value;
            const terms = document.getElementById('paymentTerms').value;
            const method = document.getElementById('defaultMethod').value;
            
            if (!name || !contact || !email) {
                window.parent.showToast('‚ö†Ô∏è Please fill in required fields');
                return;
            }
            
            const newSupplier = {
                id: suppliers.length + 1,
                name: name,
                contact: contact,
                email: email,
                phone: phone,
                rating: 4.0,
                products: ['New Products'],
                paymentTerms: parseInt(terms),
                balance: 0,
                dueDate: new Date(Date.now() + 30*24*60*60*1000).toISOString().split('T')[0],
                status: 'pending',
                autoPay: false,
                avatar: name.split(' ').map(n => n[0]).join('').substring(0, 2),
                paymentHistory: []
            };
            
            suppliers.push(newSupplier);
            closeAddSupplierModal();
            loadSuppliers();
            window.parent.showToast('‚úÖ Supplier added successfully!');
            
            // Reset form
            document.getElementById('supplierName').value = '';
            document.getElementById('contactPerson').value = '';
            document.getElementById('supplierEmail').value = '';
            document.getElementById('supplierPhone').value = '';
        }

        // Toggle auto-pay
        function toggleAutoPay() {
            // Handled in process payment
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadSuppliers();
            
            // Auto-check for overdue payments (simulate)
            setInterval(() => {
                const overdueCount = suppliers.filter(s => s.status === 'overdue').length;
                if (overdueCount > 0) {
                    window.parent.showToast(`‚ö†Ô∏è ${overdueCount} overdue payment(s) pending`);
                }
            }, 60000); // Check every minute
        });
    </script>
</body>
</html>